{% extends "base.html" %}

{% block title %}Discover Amazing Movies{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://image.tmdb.org/t/p/original/{{ backdrop_path }}');
        background-size: cover;
        background-position: center;
        color: white;
        padding: 100px 0;
        margin-bottom: 40px;
        border-radius: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="hero-section text-center mb-5">
    <h1 class="display-4 fw-bold">Discover Your Next Favorite Movie</h1>
    <p class="lead">Personalized recommendations based on your taste</p>
    <div class="mt-4">
        <a href="{{ url_for('recommend') }}" class="btn btn-primary btn-lg me-2">
            <i class="fas fa-magic me-1"></i> Get Recommendations
        </a>
        <a href="{{ url_for('search') }}" class="btn btn-outline-light btn-lg">
            <i class="fas fa-search me-1"></i> Search Movies
        </a>
    </div>
</div>

<section class="mb-5">
    <h2 class="mb-4"><i class="fas fa-fire me-2"></i> Trending Now</h2>
    <div id="trending-carousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <!-- Filled by JavaScript -->
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#trending-carousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#trending-carousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</section>

<section class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-star me-2"></i> Top Picks For You</h2>
        <button id="refresh-picks" class="btn btn-sm btn-outline-secondary">
            <i class="fas fa-sync-alt me-1"></i> Refresh
        </button>
    </div>
    <div id="top-picks" class="row">
        <!-- Filled by JavaScript -->
    </div>
</section>

<section class="mb-5">
    <h2 class="mb-4"><i class="fas fa-random me-2"></i> Surprise Me!</h2>
    <div class="text-center">
        <button id="surprise-me" class="btn btn-warning btn-lg">
            <i class="fas fa-gift me-1"></i> Show Me Random Movies
        </button>
    </div>
    <div id="surprise-results" class="row mt-4">
        <!-- Filled by JavaScript -->
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load trending movies
        fetch('/get_trending_movies')
            .then(response => response.json())
            .then(movies => {
                const carouselInner = document.querySelector('#trending-carousel .carousel-inner');
                movies.forEach((movie, index) => {
                    const item = document.createElement('div');
                    item.className = `carousel-item ${index === 0 ? 'active' : ''}`;
                    item.innerHTML = `
                        <img src="https://image.tmdb.org/t/p/w1280/${movie.backdrop_path}" class="d-block w-100 rounded" alt="${movie.title}">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>${movie.title}</h5>
                            <p>${movie.overview.substring(0, 100)}...</p>
                        </div>
                    `;
                    carouselInner.appendChild(item);
                });
            });

        // Load top picks
        function loadTopPicks() {
            const topPicks = document.getElementById('top-picks');
            topPicks.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary"></div></div>';
            
            fetch('/get_trending_movies')
                .then(response => response.json())
                .then(movies => {
                    topPicks.innerHTML = '';
                    const shuffled = movies.sort(() => 0.5 - Math.random());
                    const selected = shuffled.slice(0, 6);
                    
                    selected.forEach(movie => {
                        const col = document.createElement('div');
                        col.className = 'col-md-4 col-lg-2 mb-4';
                        col.innerHTML = `
                            <div class="card h-100 movie-card">
                                <img src="https://image.tmdb.org/t/p/w500/${movie.poster_path}" class="card-img-top" alt="${movie.title}">
                                <div class="card-body">
                                    <h6 class="card-title">${movie.title}</h6>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-primary">${movie.vote_average.toFixed(1)} ★</span>
                                        <small class="text-muted">${movie.release_date.substring(0, 4)}</small>
                                    </div>
                                </div>
                            </div>
                        `;
                        topPicks.appendChild(col);
                    });
                });
        }
        
        loadTopPicks();
        document.getElementById('refresh-picks').addEventListener('click', loadTopPicks);

        // Surprise me button
        document.getElementById('surprise-me').addEventListener('click', function() {
            const results = document.getElementById('surprise-results');
            results.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-warning"></div></div>';
            
            fetch('/get_random_movies')
                .then(response => response.json())
                .then(movies => {
                    results.innerHTML = '';
                    movies.forEach(movie => {
                        const col = document.createElement('div');
                        col.className = 'col-md-4 mb-4';
                        col.innerHTML = `
                            <div class="card h-100 movie-card">
                                <img src="https://image.tmdb.org/t/p/w500/${movie.poster_path}" class="card-img-top" alt="${movie.title}">
                                <div class="card-body">
                                    <h5 class="card-title">${movie.title}</h5>
                                    <p class="card-text">${movie.overview.substring(0, 150)}...</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-warning text-dark">${movie.vote_average.toFixed(1)} ★</span>
                                        <small class="text-muted">${movie.release_date.substring(0, 4)}</small>
                                    </div>
                                </div>
                            </div>
                        `;
                        results.appendChild(col);
                    });
                });
        });
    });
</script>
{% endblock %}